<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CASA0023 Learning Diary - 8&nbsp; Week09</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Week08.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Week09.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week09</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CASA0023 Learning Diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Personal Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week01</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week02</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week03</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week04</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week06</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week07</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week08</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week09.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week09</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#content-summary-temperature" id="toc-content-summary-temperature" class="nav-link active" data-scroll-target="#content-summary-temperature">1. Content Summary: Temperature</a>
  <ul class="collapse">
  <li><a href="#landsat-8" id="toc-landsat-8" class="nav-link" data-scroll-target="#landsat-8">1.1 Landsat 8</a></li>
  <li><a href="#moderate-resolution-imaging-spectroradiometer-modis" id="toc-moderate-resolution-imaging-spectroradiometer-modis" class="nav-link" data-scroll-target="#moderate-resolution-imaging-spectroradiometer-modis">1.2 Moderate Resolution Imaging Spectroradiometer (MODIS)</a></li>
  <li><a href="#comparsion-of-landsat-8-lst-data-and-modis-lst-data" id="toc-comparsion-of-landsat-8-lst-data-and-modis-lst-data" class="nav-link" data-scroll-target="#comparsion-of-landsat-8-lst-data-and-modis-lst-data">1.3 Comparsion of Landsat 8 LST data and MODIS LST data</a></li>
  </ul></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">2. Application</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">3. Reflection</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">4. Reference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week09</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="content-summary-temperature" class="level1 unnumbered">
<h1 class="unnumbered">1. Content Summary: Temperature</h1>
<p>Based on my discussion on heat island effect issues and policies in Singapore in week04, I found that remote sensing data has advantages in discussing heat mitigation measures. This week we will further practice using Landsat 8 and Moderate Resolution Imaging Spectroradiometer (MODIS) dataset to obtain Land Surface Temperature (LST) to discover how temperatures change with geographic space in Singapore.Figure 1 shows the region map of Singapore. In the section, satellite images from May to July 2021 are selected for analysis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week09/Figure 1.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 1 The region map of Singapore. Picture from Lu et al.&nbsp;(2023).</figcaption>
</figure>
</div>
<section id="landsat-8" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="landsat-8">1.1 Landsat 8</h2>
<p>Landsat 8 provides data with high spatial resolution (30m) and temporal resolution (16 day). The advantage of using Landsat 8 to extract LST is that it has a thermal infrared sensor (TIRS) with thermal bands. Besides, Level 2 product provides the data after radiometric correction and atmospheric correction. Furthermore, the dataset contains land surface temperature, which can be calculated directly from band 10.</p>
<p>Due to the geographical location and climatic conditions of Singapore, the availability of satellite images is significantly affected. To acquire more images, I set a relatively high cloud cover threshold (11%). Subsequently, I processed the images by converting temperature units from Kelvin to Celsius and removing any pixels that have below 0 values. Furthermore, the mean values were conducted to reduce the dimensionality. Finally, the image was clipped by boundaries vector data, shown in Figure 2.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week09/Figure 2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 2 The LST Map extracted from Landsat 8.</figcaption>
</figure>
</div>
<p>The result clearly shows missing values in the northeast areas. This is likely due to the transformation of Band 10 into temperature, where values below 0 are considered missing. This could be influenced by factors such as sensor noise, cloud cover and pre-processing steps.</p>
<p>In Singapore, the areas with high LST are primarily concentrated in the three regions, which are the western gateway, where industrial areas are concentrated, the eastern aviation hub, and the central business district (CBD) in the south. These areas with high LST further reflect the urban fabric. In contrast, green and blue areas indicate lower LST, mainly presenting as blue and green colours.</p>
</section>
<section id="moderate-resolution-imaging-spectroradiometer-modis" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="moderate-resolution-imaging-spectroradiometer-modis">1.2 Moderate Resolution Imaging Spectroradiometer (MODIS)</h2>
<p>MODIS features high temporal resolution and low spatial resolution. It consists of two sensors, Terra and Aqua. Terra passes from north to south across the equator in the morning, while Aqua passes from south to north in the afternoon. Therefore, MODIS has a higher temporal resolution, approximately 1-2 days. However, its thermal infrared bands have a spatial resolution of 1 kilometre, which is much higher than that of Landsat 8.</p>
<p>By scaling the data, merging data from Terra and Aqua, and calculating the average, the MODIS image of summer mean LST is demonstrated in Figure 3.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week09/Figure 3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 3 The LST Map extracted from MODIS.</figcaption>
</figure>
</div>
<p>In terms of identification of low-temperature areas, MODIS is basically consistent with Landsat 8, but there are some differences in high-temperature areas. MODIS shows significantly high LST areas in the southeast region.</p>
</section>
<section id="comparsion-of-landsat-8-lst-data-and-modis-lst-data" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comparsion-of-landsat-8-lst-data-and-modis-lst-data">1.3 Comparsion of Landsat 8 LST data and MODIS LST data</h2>
<p>Figure 4 and Figure 5 compare the LST distribution of Landsat 8 and MODIS. The Landsat 8 data seems to have some extremely high and low values (minimum and maximum: 2.5 and 58.5)that may show some potential errors. While MODIS LST data is distributed within a reasonable range from 25.5(minimum) to 39.1(maximum).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week09/1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figrue 4 The Tempreture Distribution of Landsat8 LST Data.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week09/2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 5 The Tempreture Distribution of MODIS LST Data.</figcaption>
</figure>
</div>
<p>Potential reasons include the following: Firstly, different atmospheric correction methods are used in the preprocessing stage, and their sensors have differentiated sensitivities to the thermal band, resulting in various results under the circumstances. Secondly, due to differences in spatial resolution, Landsat 8 can more accurately capture small-scale temperature changes, while MODIS may average temperatures over a larger range. Additionally, due to differences in temporal resolution, MODIS can more accurately capture temporal temperature changes, providing the LST results close to the ground situation.</p>
</section>
</section>
<section id="application" class="level1 unnumbered">
<h1 class="unnumbered">2. Application</h1>
<p>Based on this week’s practice of collecting LST using remote sensing data, I found that remote sensing satellite data has certain limitations when used. LST data with high spatial and temporal resolution are not available concurrently due to the mutual constraints of spatial and temporal resolution (Li et al., 2021). Landsat 8 with high spatial resolution and MODIS with high temporal resolution indicate complementary features, which can improve LST retrieval(Zhao et al., 2020). Thus, scholars have explored various applications of MODIS and LST to improve the quality of LST data.</p>
<p>Based on the characteristics of satellite images, Sidiqui, Huete and Devadas (2016) analysed time series of UHI intensity in Sydney using MODIS LST data, which could obtain the global characteristics of UHI; and then the Landsat 8 LST data was employed to capture the hot spot locations of UHI more clearly. In addition, some scholars have developed high-spatiotemporal-resolution LST data from a technical perspective. Data Fusion of MODIS and Landsat 8 is an effective method to improve the two resolutions of LST data(Zhao et al., 2020). Data fusion with multi-sensor refers to combining two or more calibrated images into a single one that has the best features of both (Ghassemian, 2016). To increase the quality of LST data, various models have been provided to merge the Landsat 8 LST data and MODIS LST data (Li et al., 2021; Zhao et al., 2020; and Yang et al., 2020), such as the Flexible Spatiotemporal Data Fusion method (FSDAF) proposed by Yang et al., (2020)and Spatial and Temporal Adaptive Reflectance Fusion Model (STARFM) proposed by Li et al.(2021). By comparing the original LST data and the ground measurements LST, the LST data generated by these models all reflect relatively good feasibility and accuracy. The combined LST data can capture the spatial pattern from Landsat 8 and also retain the temporal information from MODIS LST. Overall, this is an interesting research direction that can combine the advantages of sensors, while it also requires complex and interdisciplinary expert knowledge.</p>
</section>
<section id="reflection" class="level1 unnumbered">
<h1 class="unnumbered">3. Reflection</h1>
<p>Capturing the LST data by myself is an exciting process, although some problems affect the availability of final results. Besides, using GEE to calculate LST is more effective and time-saving, significantly reducing the computational cost. In addition, due to the limitations of current remote sensing datasets, the application section explored the various data fusion methods, providing a research direction that combines deep learning methods and multi-sensor data to enhance the resolution of LST results.</p>
<p>However, it is worth noting that LST is spatial heterogeneity but also may be affected by spatial autocorrelation. Therefore, future research can explore how to more accurately reflect the spatial distribution of LST and capture the dynamic changes of UHI through image fusion that considers resolution and spectrum. One potential idea is to include terrain or building footprint data into image fusion.</p>
<p>This course has given me a deep understanding that remote sensing is a vast interdisciplinary knowledge system. It is necessary to understand multiple subjects, such as optical mechanics, computer science, mathematics, geography, and meteorology, etc., which can better understand and apply remote sensing data. In addition, GEE and various sensor datasets have a high exploitability,allowing more exploration for preprocessing, analysis and technique development steps. I look forward to further applying remote sensing knowledge to my study and career in the future. :)</p>
</section>
<section id="reference" class="level1 unnumbered">
<h1 class="unnumbered">4. Reference</h1>
<div style="overflow-y: scroll; height: 300px;">
<p>Ghassemian, H. (2016). ‘A review of remote sensing image fusion methods’. Information Fusion, 32, pp.&nbsp;75–89. doi: 10.1016/j.inffus.2016.03.003.</p>
<p>Li, S., Wang, J., Li, D., Ran, Z. and Yang, B. (2021). ‘Evaluation of Landsat 8-like Land Surface Temperature by Fusing Landsat 8 and MODIS Land Surface Temperature Product’. Processes, 9 (12), p.&nbsp;2262. doi: 10.3390/pr9122262.</p>
<p>Lu, Y., Chen, Q., Yu, M., Wu, Z., Huang, C., Fu, J., Yu, Z. and Yao, J. (2023). ‘Exploring spatial and environmental heterogeneity affecting energy consumption in commercial buildings using machine learning’. Sustainable Cities and Society, 95, p.&nbsp;104586. doi: 10.1016/j.scs.2023.104586.</p>
<p>Sidiqui, P., Huete, A. and Devadas, R. (2016). ‘Spatio-temporal mapping and monitoring of Urban Heat Island patterns over Sydney, Australia using MODIS and Landsat-8’. in 2016 4th International Workshop on Earth Observation and Remote Sensing Applications (EORSA). 2016 4th International Workshop on Earth Observation and Remote Sensing Applications (EORSA), Guangzhou, China: IEEE, pp.&nbsp;217–221. doi: 10.1109/EORSA.2016.7552800.</p>
<p>Yang, H., Xi, C., Zhao, X., Mao, P., Wang, Z., Shi, Y., He, T. and Li, Z. (2020). ‘Measuring the Urban Land Surface Temperature Variations Under Zhengzhou City Expansion Using Landsat-Like Data’. Remote Sensing, 12 (5), p.&nbsp;801. doi: 10.3390/rs12050801.</p>
<p>Zhao, G., Zhang, Y., Tan, J., Li, C. and Ren, Y. (2020). ‘A Data Fusion Modeling Framework for Retrieval of Land Surface Temperature from Landsat-8 and MODIS Data’. Sensors, 20 (15), p.&nbsp;4337. doi: 10.3390/s20154337.</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Week08.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week08</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>