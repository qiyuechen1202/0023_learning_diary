<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>0023_learning_diary - 7&nbsp; Week08</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Week09.html" rel="next">
<link href="./Week07.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Week08.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week08</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">0023_learning_diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Personal Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week01</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week02</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week03</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week04</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week06</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week07</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week08.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week08</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week09</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#content-summary-classification-ii" id="toc-content-summary-classification-ii" class="nav-link active" data-scroll-target="#content-summary-classification-ii">1. Content Summary: Classification II</a>
  <ul class="collapse">
  <li><a href="#object-based-image-analysis-obia" id="toc-object-based-image-analysis-obia" class="nav-link" data-scroll-target="#object-based-image-analysis-obia">1.1 Object-based Image Analysis (OBIA)</a></li>
  <li><a href="#sub-pixel-analysis" id="toc-sub-pixel-analysis" class="nav-link" data-scroll-target="#sub-pixel-analysis">1.2 Sub Pixel Analysis</a></li>
  <li><a href="#accuracy-assessment" id="toc-accuracy-assessment" class="nav-link" data-scroll-target="#accuracy-assessment">1.3 Accuracy assessment</a>
  <ul class="collapse">
  <li><a href="#error-matrix-confusion-matrix" id="toc-error-matrix-confusion-matrix" class="nav-link" data-scroll-target="#error-matrix-confusion-matrix">1.3.1 Error matrix (Confusion matrix)</a></li>
  <li><a href="#kappa-coefficient" id="toc-kappa-coefficient" class="nav-link" data-scroll-target="#kappa-coefficient">1.3.2 Kappa coefficient</a></li>
  </ul></li>
  <li><a href="#others-problems-related-to-image-classification" id="toc-others-problems-related-to-image-classification" class="nav-link" data-scroll-target="#others-problems-related-to-image-classification">1.4 Others Problems Related to Image Classification</a></li>
  </ul></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">2. Application</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">3. Reflection</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">4. Reference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week08</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This week, we explore more classification methods and discuss the accuracy assessment for image classification.</p>
<section id="content-summary-classification-ii" class="level1 unnumbered">
<h1 class="unnumbered">1. Content Summary: Classification II</h1>
<section id="object-based-image-analysis-obia" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="object-based-image-analysis-obia">1.1 Object-based Image Analysis (OBIA)</h2>
<p>Compared to pixel-based supervised and unsupervised classification, OBIA aims to group pixels into objects, which are vector shapes with size and geometry (GISGeography,2024). Through the application of OBIA, the feature statistics of various objects, encompassing spectral, contextual, and shape features, can be captured to the fullest extent (Blaschke, 2010). Thus, the method connects raster EO data and vector data in the Geographic Information System ( Hay and Castilla,2008). As shown in Figure 1, OBIA consists of two main phases: (1) Image Segmentation Phase and (2) Post-segmentation Phase ( feature extraction and classification).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week08/Segmentation steps.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 1: The Segmentation steps of Object-based Image Analysis (OBIA). Picture source from TwEz-zahouani et al.&nbsp;(2023)</figcaption>
</figure>
</div>
<p>However, it is worth noting that OBIA also has significant uncertainties in image processing. Hao, Cui and Wang (2021) indicate that the challenges have led to various issues, such as the selection of segmentation scale, training samples, and accuracy assessment, influencing the accuracy of image feature extraction. Therefore, we must carefully consider the segmentation methods we use when conducting OBIA.</p>
<ul>
<li><strong>Simple Linear Iterative Clustering (SLIC)</strong></li>
</ul>
<p>In the lecture, the SLIC Algorithm is introduced as the common method of OBIA. SLIC is an adaptation of the k-means clustering algorithm for superpixel generation (Csillik, 2016). As the only parameter of the algorithm, K (the desired number of approximately equally sized superpixels) needs to be set, and superpixels are created by grouping nearby pixels with colour and spatial attributes proximity, considering the objects based on the similarity or difference of the pixels (Achanta et al.,2012). Regarding the working principle, the method adopts an algorithm that initiates from an initial rough pixel clustering and iteratively enhances the clusters until certain criteria are satisfied, ultimately forming superpixels(Csillik, 2016).</p>
<p>Regarding the advantages of using SLIC, Achanta et al.&nbsp;(2012) indicate that SLIC surpasses current methods in computation speed, reducing computational complexity, memory efficiency, and boundary adherence, which can enhance the efficacy and quality of segmentation algorithms. However, Csillik (2017) illustrates the disadvantages of using superpixels and emphasises the need to carefully choose the size of superpixels: smaller superpixels can improve the geometric accuracy of objects but increase the computational time; larger superpixels ignore important boundaries and increase the internal heterogeneity of objects (Figure 2).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week08/SLIC.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 2 Comparing visualisation of superpixels captured by SLIC and SLICO(a free SLIC version).Picture source from Csillik (2017).</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>Left: 5 × 5 pixels, middle: 10 × 10 pixels, and right: 15 × 15 pixels.</p>
</blockquote>
</section>
<section id="sub-pixel-analysis" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sub-pixel-analysis">1.2 Sub Pixel Analysis</h2>
<p>Also known as Sub-pixel Classification, Spectral Mixture Analysis (SMA), Linear Spectral Unmixing.</p>
<p>Spectral Mixture Analysis (SMA) is proposed to accurately identify and quantify mixed land cover in real-world EO data. SMA is employed to compute the proportions or abundance of different land cover types within a pixel, and this method involves representing a mixed spectrum within the pixel as a mixture of spectra corresponding to pure land cover types(endmembers)(Wu and Murray, 2003). Perez Machado and Small (2013) indicate that SMA improves image interpretability, as it considers the physical processes leading to the observed radiances (below pixel scale) and allows for the presence of mixed pixels. There are two methods of SMA, which are linear and nonlinear. In research, the linear ones are usually employed (Wu and Murray, 2003; Perez Machado and Small,2013), as illustrated in Figure 3</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week08/LSMM.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 3 The example of Linear Spectral Mixture Model (LSMM). Picture from Perez Machado and Small (2013).</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>Linear Spectral Mixture Model (LSMM) considers the mixture as a linear combination of the different components of the pixel weighted by their respective proportions.</p>
</blockquote>
</section>
<section id="accuracy-assessment" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="accuracy-assessment">1.3 Accuracy assessment</h2>
<p>Following the classification production, it is necessary to assign an accuracy assessment to the classification results.</p>
<section id="error-matrix-confusion-matrix" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-matrix-confusion-matrix">1.3.1 Error matrix (Confusion matrix)</h3>
<p>The matrix is used to visualise the accuracy performance of classification, which is sub-classified into two types: the binary and the multiclass confusion matrix.</p>
<ul>
<li><p>In the binary cases, accuracy performance is measured by:</p>
<ul>
<li>Producer accuracy</li>
<li>User’s accuracy</li>
<li>Overall accuracy</li>
</ul></li>
</ul>
<p>The details and equations can be found in<a href="https://isprs-archives.copernicus.org/articles/XLII-3/61/2018/isprs-archives-XLII-3-61-2018.pdf">Barsi(2018)</a></p>
<ul>
<li><p>In the multiclass cases, accuracy performance is measured by:</p>
<ul>
<li>Errors of omission (100-producer’s accuracy)</li>
<li>Errors of commission (100- user’s accuracy)</li>
<li>Overall accuracy: The proportion of diagonal elements(correct classification) to the total</li>
</ul></li>
</ul>
<p>The details and equations can be found in <a href="https://medium.com/@wenzhao.li1989/accuracy-assessment-d164e492274b">Earth System Science and Remote Sensing (2020)</a></p>
<ul>
<li>Others: F1 Score</li>
</ul>
<p>When using real EO data for machine learning, we often encounter some problems in accuracy assessment. For example, We can’t have both a high producer accuracy (recall) and a high user accuracy (precision).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source/week08/F1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure4 The equation of F1 score. Picture from MacLachlan (2024).</figcaption>
</figure>
</div>
<p>F1_Score is a balance between precision and recall, takes beta attribute which weights precision or recall (usually beta = 1) (Figure 4). The socre ranges from 0 to 1, with 1 representing the model’s best output and 0 representing the model’s worst output.</p>
</section>
<section id="kappa-coefficient" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="kappa-coefficient">1.3.2 Kappa coefficient</h3>
<p>The Kappa coefficient is widely advocated and employed as a metric for assessing accuracy in remote sensing.</p>
<ul>
<li>It is generated from a statistical measure to evaluate the accuracy of a classification.</li>
<li>Range from 0 to 1</li>
<li>However, Based on the research results. Foody(2020) indicates that the Kappa coefficient is flawed and/or irrelevant to the accuracy assessment of remote sensing classification.</li>
</ul>
</section>
</section>
<section id="others-problems-related-to-image-classification" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="others-problems-related-to-image-classification">1.4 Others Problems Related to Image Classification</h2>
<ol type="1">
<li>What data should we use to assess the accuracy of our classification models</li>
</ol>
<ul>
<li><p><strong>Improving workflow</strong>:</p>
<ul>
<li>train-test data split</li>
<li>Conduct cross validation /Leave one out cross validation(an extreme version of cross validation)</li>
</ul></li>
</ul>
<ol type="1">
<li><p>When training and testing the classification models, do we need to consider spatial autocorrelation? Do the following help:</p>
<ul>
<li>Object based image analysis</li>
<li>Spatial cross validation</li>
</ul></li>
</ol>
</section>
</section>
<section id="application" class="level1 unnumbered">
<h1 class="unnumbered">2. Application</h1>
</section>
<section id="reflection" class="level1 unnumbered">
<h1 class="unnumbered">3. Reflection</h1>
</section>
<section id="reference" class="level1 unnumbered">
<h1 class="unnumbered">4. Reference</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Week07.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week07</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Week09.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week09</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>